<!DOCTYPE html>
<#if session_user.type!=4>
	<div style="padding:100px;text-align: center;line-height: 200px;font-size:32px;">
		<a href="${basePath}" style="color:#333">你们没有添加的权限，可以联系管理员进行开通确认.点击返回！</a>
	</div>
<#else>
<html>
<head>
	<meta charset="UTF-8">
	<title>添加博文-中华墨风 -'s Zone</title>
	<meta name="description" content="一切皆为年少轻狂之诳语·DeepLearning 小白">
	<meta name="keywords" content="Hexo,next">
	<#include "template/commons.html"/>
	<#include "template/js.html"/>
	<link href="${basePath}/js/ueditor/themes/default/css/ueditor.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8" src="${basePath}/js/ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="${basePath}/js/ueditor/ueditor.all.js"></script>
    <!--引入CSS-->
	<link rel="stylesheet" type="text/css" href="${basePath}/js/webuploader/webuploader.css">
	<!--引入JS-->
	<script type="text/javascript" src="${basePath}/js/webuploader/webuploader.js"></script>
	<style>body{overflow-y:auto;overflow-x:hidden;background-color:#f3f5f6;height:98%;}body #nav{z-index:8}body #main{padding:0;min-height:0;margin:30px;}
	body #main .article-wrap .article-title{padding:28px 0 24px;width:100%;font-weight:700;font-size:24px;color:#1C1F21;line-height:30px;border:none;outline:none;box-sizing:content-box;}
	body #main .article-head{top:0;position:fixed;height:68px;z-index:3;right:0;left:0;background: #f8f8f8;box-shadow: 0 0 1em #ccc}body #main .article-head .draft-warp{float:left;margin:16px 0 0 24px;position:relative}body #main .article-head .draft-warp{float:left;margin:16px 0 0 24px;position:relative}
	body #main .article-head .draft-warp .draft-btn{float:left;position:relative;height:36px;background:rgba(28,31,33,.08);color:#545C63;border-radius:18px}
	body #main .article-head .draft-warp .draft-btn.active{background:rgba(0,85,255,.1);color:#05F}
	body #main .article-head .draft-warp .draft-btn>p{text-align:center;cursor:pointer;margin:0;padding:0 16px;}
	body #main .article-head .draft-warp .draft-btn>p a{border-bottom:0;}
	body #main .article-head .draft-warp .draft-btn>p i{position:relative;top:2px;font-size:16px}
	body #main .article-head .draft-warp .draft-btn>p span{font-size:14px;line-height:36px}
	body #main .article-head .draft-warp .draft-btn .draft-num{position:absolute;top:-4px;right:-4px;padding:2px 4px;background:#F20D0D;border-radius:8px;font-size:12px;color:#fff;line-height:12px}body #main .article-head .draft-warp .draft-tip{float:left;margin:8px 0 0 12px;font-size:12px;color:#9199A1;line-height:18px}body #main .article-head .draft-warp .draft-container{position:absolute;top:52px;z-index:3;width:384px;height:366px;padding:16px;box-sizing:border-box;box-shadow:0 8px 16px 0 rgba(7,17,27,.2);background-color:#fff;border-radius:12px}body #main .article-head .draft-warp .draft-container .arrow-icon{display:block;width:0;height:0;border-width:0 16px 16px;border-style:solid;border-color:transparent transparent #fff;position:absolute;top:-16px}body #main .article-head .draft-warp .draft-container .draft-container-title span:first-child{float:left;font-weight:700;font-size:14px;color:#1C1F21;line-height:22px}body #main .article-head .draft-warp .draft-container .draft-container-title span:nth-child(2){float:right;font-size:12px;color:#9199A1;line-height:18px}body #main .article-head .draft-warp .draft-container .draft-list{margin-top:14px;height:298px}body #main .article-head .draft-warp .draft-container .draft-list .draft-item{display:block;height:60px;padding:12px;background:rgba(84,92,99,.05);border-radius:8px;box-sizing:border-box;cursor:pointer}body #main .article-head .draft-warp .draft-container .draft-list .draft-item:not(:first-child){margin-top:4px}body #main .article-head .draft-warp .draft-container .draft-list .draft-item .draft-icon{float:left;font-size:32px;color:#B2B8BD;line-height:36px}body #main .article-head .draft-warp .draft-container .draft-list .draft-item .draft-item-info{float:left;margin-left:12px;width:244px}body #main .article-head .draft-warp .draft-container .draft-list .draft-item .draft-item-info h4{font-weight:700;font-size:14px;color:#545C63;line-height:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin:0}body #main .article-head .draft-warp .draft-container .draft-list .draft-item .draft-item-info p{font-size:12px;color:#9199A1;line-height:16px;margin:0}body #main .article-head .draft-warp .draft-container .draft-list .draft-item .draft-del{display:none;float:right;font-size:20px;color:#B2B8BD;line-height:36px}body #main .article-head .draft-warp .draft-container .draft-list .draft-item:hover{background:rgba(0,85,255,.1)}body #main .article-head .draft-warp .draft-container .draft-list .draft-item:hover .draft-item-info h4{color:#05F}body #main .article-head .draft-warp .draft-container .draft-list .draft-item:hover .draft-del{display:block}body #main .article-head .editor-change-warp{position:absolute;left:50%;transform:translate(-50%);margin-top:22px}body #main .article-head .editor-change-warp span{padding:4px 12px;font-size:12px;color:#545C63;line-height:16px;cursor:pointer}body #main .article-head .editor-change-warp span.active{background:#9199A1;color:#FFF;border-radius:12px}body #main .article-head .editor-change-warp span:first-child{margin-right:12px}body #main .article-head .publish-btn{display:block;float:right;margin:16px 24px 0 0;width:88px;height:36px;line-height:36px;text-align:center;font-size:14px;color:#fff;background:#37f;border-radius:18px;cursor:pointer}
	body #main .article-wrap{z-index:2;width:960px;height:auto;position:absolute;left:0;right:0;margin:70px auto;padding:0 32px 32px;box-sizing:border-box;background:#FFF;box-shadow:0 8px 16px 0 rgba(28,31,33,.1);border-radius:12px}body #main .article-wrap .article-title{padding:28px 0 24px;width:100%;font-weight:700;font-size:24px;color:#1C1F21;line-height:30px;box-sizing:content-box}body #main .article-wrap .article-title:-moz-placeholder,body #main .article-wrap .article-title:-ms-input-placeholder,body #main .article-wrap .article-title::-moz-placeholder,body #main .article-wrap .article-title::-webkit-input-placeholder{color:#9199A1}body #main .article-info-modal .modal-dialog{width:672px;margin-top:-233px;margin-left:-336px}body #main .article-info-modal .modal-dialog .modal-content{border-radius:12px;border:none}body #main .article-info-modal .modal-dialog .modal-content .modal-body{padding:32px 32px 0}body #main .article-info-modal .modal-dialog .modal-content .modal-body .first-enter-tip{padding:4px 6px;box-sizing:border-box;background:#FA0;box-shadow:0 4px 8px 0 rgba(255,170,0,.4);border-radius:6px;position:absolute}body #main .article-info-modal .modal-dialog .modal-content .modal-body .first-enter-tip .arrow-icon{display:block;width:0;height:0;border-width:6px 6px 0;border-style:solid;border-color:#FA0 transparent transparent;position:absolute;top:26px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .first-enter-tip p{font-size:12px;color:#FFF;line-height:18px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .first-enter-tip p i{display:block;float:right;height:18px;font-size:14px;color:rgba(255,255,255,.6);line-height:18px;cursor:pointer}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left{width:128px;position:relative}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-box{width:128px;height:128px;background:#F8FAFC;border-radius:8px;background-size:100% 100%;text-align:center}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-box i{display:inline-block;margin-top:40px;font-size:48px;color:#D9DDE1}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left>span{display:block;width:128px;height:24px;line-height:24px;border-radius:12px;text-align:center;font-size:12px;cursor:pointer}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-btn{margin-top:16px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-btn .webuploader-pick{padding:0;background:#383D42;border-radius:12px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-btn>div{width:128px!important;height:24px!important}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-random-btn{margin-top:12px;background:rgba(28,31,33,.08);color:#545C63}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .pic-upload-tip{margin-top:8px;font-size:12px;color:#9199A1;line-height:22px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .first-enter-tip{width:150px;top:108px;left:-14px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-left .first-enter-tip .arrow-icon{left:68px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right{width:448px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .common-title{margin-bottom:8px;font-weight:700;font-size:14px;color:#1C1F21;line-height:22px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .column-warp{width:280px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .original-warp{width:144px;position:relative}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .original-warp .first-enter-tip{top:-10px;left:-48px;width:158px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .original-warp .first-enter-tip .arrow-icon{left:72px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp{margin-top:24px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .common-title span{margin-left:4px;font-weight:400;font-size:12px;color:#93999F;line-height:22px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .tag-item{display:block;float:left;margin:8px 8px 0 0;padding:4px 12px;font-size:12px;color:#545C63;line-height:16px;background:rgba(84,92,99,.1);border-radius:12px;cursor:pointer}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .tag-list{margin-top:16px;height:auto!important;max-height:160px;overflow-y:auto}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .tag-list .nano-content{position:static}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-box{width:100%;height:36px;padding-left:12px;margin-right:12px;background:#FFF;border:1px solid #9199A1;border-radius:6px;box-sizing:border-box}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-box input{width:100%;height:100%;border-radius:6px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-box>div{height:100%}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-box .tag-item{margin-top:6px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-result{margin:24px 0 -16px;font-size:12px;color:#9199A1;line-height:18px}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .tag-warp .search-result span{color:#05f}body #main .article-info-modal .modal-dialog .modal-content .modal-body .modal-body-right .common-error-tip{margin-top:2px;font-size:12px;color:#F53D3D;line-height:18px}body #main .article-info-modal .modal-dialog .modal-content .modal-footer{padding:32px;position:relative}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .btn{height:36px;line-height:36px;padding:0 24px;border-radius:18px;border:none}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .btn-normal{background:rgba(28,31,33,.08);color:#545C63}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .btn-blue{background:#37f;color:#FFF}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .captcha-verify-box{position:absolute;right:-80px;bottom:78px;padding:6px;width:320px;background:#fff;border-radius:4px;border:1px solid #d0d6d9;z-index:9}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .captcha-verify-box:after{position:absolute;bottom:-11px;left:156px;content:" ";display:block;width:0;height:0;border-top:10px solid #d0d6d9;border-left:10px solid transparent;border-right:10px solid transparent;z-index:9}body #main .article-info-modal .modal-dialog .modal-content .modal-footer .captcha-verify-box:before{position:absolute;bottom:-9px;left:157px;content:" ";display:block;width:0;height:0;border-top:9px solid #fff;border-left:9px solid transparent;border-right:9px solid transparent;z-index:10}body #main .article-modal .modal-dialog{width:500px;margin-top:-219px;margin-left:-250px}body #main .article-modal .modal-dialog .modal-header{min-height:16.5px;padding:10px 20px}body #main .article-modal .modal-dialog .modal-header .close{margin-top:3px}body #main .draftpop-modal .modal-dialog{top:30%;width:320px;margin-left:-160px}body #main .draftpop-modal .modal-dialog .modal-content{padding:17px}body #main .draftpop-modal .modal-dialog .modal-content .modal-footer .btn-normal,body #main .draftpop-modal .modal-dialog .modal-content .modal-footer .btn-red{width:auto;padding:0 24px;line-height:36px;text-align:center;border-radius:2px}body #main .draftpop-modal .modal-dialog .modal-content .modal-footer .btn-normal{border:1px solid #D9DDE1}body #main .draftpop-modal .modal-dialog .modal-content .modal-footer .btn-red{margin-left:8px}body #main .draftpop-modal .modal-dialog h3{font-size:16px;color:#07111B;line-height:24px;margin-bottom:8px}body #main .draftpop-modal .modal-dialog p{font-size:12px;color:#4D555D;line-height:20px}body #main .editor-help-modal .modal-dialog{width:576px;margin-left:-288px;margin-top:-211px}body #main .editor-help-modal .modal-dialog .modal-content{background:rgba(28,31,33,.8);border-radius:12px}body #main .editor-help-modal .modal-dialog .modal-content .modal-header{padding:28px 32px 24px}body #main .editor-help-modal .modal-dialog .modal-content .modal-header .modal-title{font-weight:700;color:#FFF}body #main .editor-help-modal .modal-dialog .modal-content .modal-header .close{font-size:24px;color:rgba(255,255,255,.2)}body #main .editor-help-modal .modal-dialog .modal-content .modal-body{padding:0 48px 48px}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item{display:flex;align-items:center;padding:8px 0;border-top:1px solid rgba(255,255,255,.2)}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item:last-child{border-bottom:1px solid rgba(255,255,255,.2)}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item>span{color:#FFF}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item .help-icon{display:inline-block;width:32px;height:32px;line-height:32px;background:#FFF;border-radius:4px;font-size:18px;color:#333;text-align:center}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item .help-icon svg.icon{width:18px;height:18px;margin:7px}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item .icon-desc{width:80px;margin-left:12px;font-weight:700;font-size:14px;line-height:22px}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item .shortcut-key{width:80px;margin-left:12px;font-size:12px;line-height:18px}body #main .editor-help-modal .modal-dialog .modal-content .modal-body .help-item .example{display:none;width:160px;margin-left:12px;font-size:12px;line-height:18px}
	.settingbox{padding:20px 0}
	.settingbox div{margin:5px 0 20px;}
	.settingbox div label{padding:0 0 4px;}
	.tb-area,.tb-input,.tb-select{width: 100%;border-radius:4px;border:1px solid #eee;padding:10px 6px;outline: none;}
	.tb-area,.tb-input{padding:10px 0;text-indent: 1em;resize: none;}
	.tb-upload-box{background:#f8f8f8;padding:10px 10px 40px;border:8px dashed #e5e5e5;height: 200px;text-align: center;line-height: 220px;}
	.tb-upload-box .alink{font-size: 24px;color:#999;display: block;border-bottom: none;}
	input[readonly]{background:#eee;}
	.webuploader-pick{position: absolute;padding:0;right:0;top:0;width:50%;background:rgba(0, 183, 238, 0.6)}
	.tb-upload-box .tciamg{    position: absolute;
    top: 0;
    left: 0;
    width: 47%;
    height: 220px;
    margin: 15px;}
	</style>
</head>
<body  oncontextmenu = "return false" >
	<div id="main" style="">
		<div class="article-head clearfix">
			<div class="draft-warp clearfix">
				<div class="draft-btn js-mydraft">
					<p class="fl">
						<a href="${basePath}" style="margin-right: 10px;">
							<i class="fa fa-home pr ftp1"></i>&nbsp;
							<span class="draft-btn-text">返回首页</span>
						</a>
						<span>|</span>
						<a href="javascript:void(0);" id="settinglink">
							&nbsp;&nbsp;<i class="fa fa-send pr ftp1"></i>&nbsp;
							<span class="draft-btn-text">基本信息</span>
						</a>
						<a href="javascript:void(0);" onclick="staticindex()" class="nav-item"><span>&nbsp;|&nbsp;&nbsp;</span>静态化首页</a>
						<a href="javascript:void(0);" onclick="staticblog()" class="nav-item"><span>&nbsp;|&nbsp;&nbsp;</span>静态化文章</a>
						<#if blog??>
							<a href="javascript:void(0);" onclick="staticblogid(${blog.id})" class="nav-item"><span>&nbsp;|&nbsp;&nbsp;</span>静态化当前</a>
							<span>|</span>
							<a href="${basePath}/${blog.staticLink}" target="_blank">
								&nbsp;&nbsp;<i class="fa fa-send pr ftp1"></i>&nbsp;
								<span class="draft-btn-text">查看文章</span>
							</a>
						</#if>
					</p>
				</div>
				<span class="fl fz12 pr" style="top:8px;padding-left: 10px;"><a href="${basePath}/user">登录的用户是：${session_user.username}</a></span>
				<a href="${basePath}/nlogout" class="fl fz12 pr"  style="top:8px;padding-left: 10px;border-bottom: none;text-decoration: underline;">退出</a>
			</div>
			<span class="publish-btn js-article-publish" id="js-article-publishx"><i class="fa fa-send pr ftp1"></i>&nbsp;发表</span>
		</div>

	
	<div class="article-wrap">
		<form id="blogform">
			<div class="settingbox animated fadeIn">
			<input type="hidden" id="blogid" name="id" value="${blog.id}"/>
			<div><label>关联课程：
				<select class="tb-select" name="courseId">
					<option value="">---- 请选择课程 ----</option>
					<@courseList>
						<option ${(blog.courseId==course.id)?string('selected','')} value="${course.id}">${course.title}</option>	
					</@courseList>
				</select></label>
			</div>
			<div><label>文章分类：
				<select class="tb-select" name="categoryId">
					<option value="">---- 请选择分类 ----</option>
					<@categoryList>
						<option ${(blog.categoryId==category.id)?string('selected','')} value="${category.id}">${category.name}</option>	
					</@categoryList>
				</select></label>
			</div>
			<div><label>点击数：<input type="text" name="hits" class="tb-input" value="${blog.hits}"/></label></div>
			<div><label>收藏数：<input type="text" name="loves" class="tb-input" value="${blog.loves}"/></label></div>
			<div><label>文章标签：<input type="text" name="tag" class="tb-input" value="${blog.tag}"/></label></div>
			<#if blog??><div><label>上传时间：<input type="text" name="createTime" class="tb-input" value="${(blog.createTime)?string('yyyy-MM-dd HH:mm:ss')}"/></label></div></#if>
			<div><label>上传用户：<input type="text" name="username" class="tb-input"  readonly="readonly" value="${blog.user.username}"/></label></div>
			<div><label>排版列数：<input type="text" name="kcolumn" class="tb-input" value="${blog.kcolumn}"/></label></div>
			<div><label>排版宽度：<input type="text" name="width" class="tb-input" value="${blog.width}"/></label></div>
			<div>上传封面：
				<input type="hidden" name="img" id="blog_to_img"  value="${blog.img}"/>
				<div class="tb-upload-box pr">
					<img src="${basePath}/${blog.img}" class="tciamg" onerror="imgError(this)"  id="blog_img"/>
					<a href="javascript:void(0);" data-dir="blog" data-to="#blog_to_img" class="alink" id="filePicker">上传封面</a>
				</div>
			</div>
			<div>上传音乐：
				<input type="hidden" name="musicLink"  id="blog_musiclink"  value="${blog.musicLink}"/>
				<div class="tb-upload-box pr">
					<audio src="${basePath}/${blog.musicLink}" class="tciamg" id="blog_audio" controls="controls"></audio>
					<a href="javascript:void(0);" data-dir="mp3" data-to="#blog_musiclink" class="alink" id="filePicker2">上传音乐</a>
				</div>
			</div>
			<div>
				上传视频：
				<textarea class="tb-area" name="videolink" style="height: 200px;">${blog.videolink}</textarea>	
			</div>
			<div><label>单价：<input type="text" name="price" class="tb-input" value="${blog.price}"/></label></div>
			<div>是否评论：
				<label><input type="radio" value="1" class="tb-radio"  ${(!blog?? || blog.isComment==1)?string("checked","")} name="isComment"/>Yes</label>
				<label><input type="radio" value="0"  class="tb-radio" ${(blog.isComment==0)?string("checked","")} name="isComment"/>No</label>
			</div>
			<div>是否播放：
				<label><input type="radio" value="1" class="tb-radio"  ${(blog.isOpen==1)?string("checked","")} name="isOpen"/>Yes</label>
				<label><input type="radio" value="0" class="tb-radio"  ${(!blog?? ||  blog.isOpen==0)?string("checked","")} name="isOpen"/>No</label>
			</div>
			<div>是否发布：
				<label><input type="radio" value="1" class="tb-radio"  ${(!blog?? || blog.status==1)?string("checked","")} name="status"/>Yes</label>
				<label><input type="radio" value="0" class="tb-radio"  ${(blog.status==0)?string("checked","")} name="status"/>No</label>
			</div>
			<div><label>静态地址：<input type="text" name="staticLink" value="${blog.staticLink}" class="tb-input"/></label></div>
			<div><label>APP地址：<input type="text" name="appLink" value="${blog.appLink}" class="tb-input"/></label></div>
		</div>
		<input type="text"  value="${blog.title}"  name="title" maxlength="100" id="article_title" class="article-title" placeholder="请在此输入标题" style="width: 100%; border-right: none;">
		<div class="article-content" style="">
		   <script id="editor" type="text/plain" style="width:890px;height:600px;">${blog.description}</script>
		</div>
		</form>
	</div>
</div>
<#if blog??>
<script>
	$(function(){
		$(".tb-input,.tb-select,.tb-area,.tb-radio,#article_title").on("blur",function(){
			var field = $(this).attr("name");
			var value = $(this).val();
			var opid = $("#blogid").val();
			var params = {};
			params[field] =value;
			params["id"]=opid;
			request(basePath+"/admin/blog/updateBlog",function(response){
				if(response.status==200){
					mkCommon.tip("修改成功","success");
				}
			},params);
		});
	});
	
</script>
</#if>
		
<script type="text/javascript">
	$(function(){
		
		var editor = UE.getEditor('editor');
		editor.addListener("keyup",function(){ 
			var opid = $("#blogid").val();
			if(isEmpty("opid")){
				setSession("blog_ueditor_content",editor.getContent());
				setSession("blog_ueditor_title",$("#article_title").val());
			}
		});
		
		$("#article_title").on("blur",function(){
			var opid = $("#blogid").val();
			if(isEmpty("opid")){
				setSession("blog_ueditor_content",editor.getContent());
				setSession("blog_ueditor_title",$("#article_title").val());
			}
		});
		
		$("#settinglink").on("click",function(){
			$(".settingbox").toggle();
		});
		
		$("#js-article-publishx").on("click",function(){
			var params = $("#blogform").serialize();
			//获取带有格式的内容
			var content = UE.getEditor('editor').getContent();
			//判断文本编辑器是否有内容
			var contentflag = UE.getEditor('editor').hasContents();
			var title = $("#article_title").val();
			
			if(isEmpty(title)){
				alert("请输入标题....");
				$("#article_title").focus();
				return;
			}
			
			if(!contentflag){
				alert("请输入内容....");
				UE.getEditor('editor').focus();
				return;
			}
			var url = "saveBlog"
			var blogid = $("#blogid").val();
			if(isNotEmpty(blogid)){
				url="updateBlog";
			}
			
			var promise = $.post(basePath+"/admin/blog/"+url,params);
			promise.done(function(response){
				if(response.status==200){
					if(isNotEmpty(blogid)){
						staticblogid(blogid);
						mkCommon.tip("修改成功","success");
					}else{
						mkCommon.tip("保存成功","success");
						$("#article_title").val("");
						UE.getEditor('editor').setContent("",false);
						staticblogid(response.data.id);
						window.location.href = basePath+"/admin/editBlog/"+response.data.id;
					}
					
					//清空缓存
					removeSession("blog_ueditor_content");
					removeSession("blog_ueditor_title");
				}
			});
		});
		
		editor.ready(function(){
			var edithtml = getSession("blog_ueditor_content");
			var title = getSession("blog_ueditor_title");
			UE.getEditor('editor').setContent(edithtml,false);
			$("#article_title").val(title)
		});
		
		loadUpload("#filePicker");
		loadUpload("#filePicker2");
	});
	
	

	
	function loadUpload(targetId){
		var dir = $(targetId).data("dir");
		var to = $(targetId).data("to");
		// 初始化Web Uploader
		var uploader = WebUploader.create({
		    // 选完文件后，是否自动上传。
		    auto: true,
		    fileVal :"doc",
		    // swf文件路径
		    swf: basePath + '/js/webuploader/Uploader.swf',
		    formData:{"dir":dir},
		    // 文件接收服务端。
		    server: basePath+'/upload/file',
		    // 选择文件的按钮。可选。
		    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
		    pick: targetId,
		    // 只允许选择图片文件。
		    accept: {
		        title: 'Images',
		        extensions: 'gif,jpg,jpeg,bmp,png,mp3,gcc',
		        mimeTypes: 'image/*;audio/*'
		    }
		});
		
		
		// 文件上传过程中创建进度条实时显示。
		uploader.on( 'uploadProgress', function( file, percentage ) {
			//var percent = percentage * 100 + '%';		   
			//console.log("上传的进度是："+percent);
		});

		// 文件上传成功，给item添加成功class, 用样式标记上传成功。
		uploader.on( 'uploadSuccess', function( file,response) {
			var field = "img";
			if(dir=="blog"){
				$("#blog_to_img").val(response.path)
				$("#blog_img").attr("src",basePath+"/"+response.path);
			}else{
				$("#blog_musiclink").val(response.path)
				$("#blog_audio").attr("src",basePath+"/"+response.path);
				field="musicLink";
			}
			
			var opid = $("#blogid").val();
			if(isNotEmpty(opid)){
				var params = {};
				params[field] =response.path;
				params["id"]=opid;
				request(basePath+"/admin/blog/updateBlog",function(response){
					if(response.status==200){
						mkCommon.tip("修改成功","success");
					}
				},params);
			}
			
		});
	}
	
	//禁止右键
    document.oncontextmenu = function(){
        return false;
    };
    
    //监听ctrl+s
    document.onkeydown=function()   {
        if (event.ctrlKey == true && event.keyCode == 83) {//Ctrl+S
        	$("#js-article-publishx").trigger("click");
            event.returnvalue = false;
            return false;
        }
    };
    
    
    
</script>
</body>
</html>
</#if>